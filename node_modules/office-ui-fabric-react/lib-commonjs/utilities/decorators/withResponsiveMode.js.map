{"version":3,"file":"withResponsiveMode.js","sourceRoot":"../src/","sources":["utilities/decorators/withResponsiveMode.tsx"],"names":[],"mappings":";;;AAAA,6BAA+B;AAC/B,iDAAgD;AAChD,6CAA0D;AAM1D,IAAY,cAOX;AAPD,WAAY,cAAc;IACxB,qDAAS,CAAA;IACT,uDAAU,CAAA;IACV,qDAAS,CAAA;IACT,uDAAU,CAAA;IACV,yDAAW,CAAA;IACX,2DAAY,CAAA;AACd,CAAC,EAPW,cAAc,GAAd,sBAAc,KAAd,sBAAc,QAOzB;AAED,IAAM,yBAAyB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;AAEzE,IAAI,YAAwC,CAAC;AAE7C;;GAEG;AACH,SAAgB,iBAAiB,CAAC,cAA0C;IAC1E,YAAY,GAAG,cAAc,CAAC;AAChC,CAAC;AAFD,8CAEC;AAED,SAAgB,kBAAkB,CAChC,iBAAyF;IAEzF,IAAM,WAAW;QAAoC,8CAA+C;QAClG,4BAAY,KAAa;YAAzB,YACE,kBAAM,KAAK,CAAC,SAMb;YALC,KAAI,CAAC,2BAA2B,GAAG,KAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;YAE/E,KAAI,CAAC,KAAK,GAAG;gBACX,cAAc,EAAE,KAAI,CAAC,kBAAkB,EAAE;aAC1C,CAAC;;QACJ,CAAC;QAEM,8CAAiB,GAAxB;YAAA,iBAUC;YATC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE;gBAChC,IAAM,cAAc,GAAG,KAAI,CAAC,kBAAkB,EAAE,CAAC;gBAEjD,IAAI,cAAc,KAAK,KAAI,CAAC,KAAK,CAAC,cAAc,EAAE;oBAChD,KAAI,CAAC,QAAQ,CAAC;wBACZ,cAAc,EAAE,cAAc;qBAC/B,CAAC,CAAC;iBACJ;YACH,CAAC,CAAC,CAAC;QACL,CAAC;QAEM,iDAAoB,GAA3B;YACE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACzB,CAAC;QAEM,mCAAM,GAAb;YACU,IAAA,0CAAc,CAAgB;YAEtC,OAAO,oBAAC,iBAAiB,qBAAC,GAAG,EAAE,IAAI,CAAC,2BAA2B,EAAE,cAAc,EAAE,cAAc,IAAM,IAAI,CAAC,KAAY,EAAI,CAAC;QAC7H,CAAC;QAEO,+CAAkB,GAA1B;YACE,IAAI,cAAc,GAAG,cAAc,CAAC,KAAK,CAAC;YAC1C,IAAM,GAAG,GAAG,qBAAS,EAAE,CAAC;YAExB,IAAI,OAAO,GAAG,KAAK,WAAW,EAAE;gBAC9B,IAAI;oBACF,OAAO,GAAG,CAAC,UAAU,GAAG,yBAAyB,CAAC,cAAc,CAAC,EAAE;wBACjE,cAAc,EAAE,CAAC;qBAClB;iBACF;gBAAC,OAAO,CAAC,EAAE;oBACV,uGAAuG;oBACvG,cAAc,GAAG,cAAc,CAAC,KAAK,CAAC;iBACvC;aACF;iBAAM;gBACL,IAAI,YAAY,KAAK,SAAS,EAAE;oBAC9B,cAAc,GAAG,YAAY,CAAC;iBAC/B;qBAAM;oBACL,MAAM,IAAI,KAAK,CACb,4FAA4F;wBAC1F,+DAA+D,CAClE,CAAC;iBACH;aACF;YAED,OAAO,cAAc,CAAC;QACxB,CAAC;QACH,yBAAC;IAAD,CAAC,AA1DmB,CAAiC,6BAAa,EA0DjE,CAAC;IACF,OAAO,wBAAY,CAAC,iBAAiB,EAAE,WAAW,CAAC,CAAC;AACtD,CAAC;AA/DD,gDA+DC","sourcesContent":["import * as React from 'react';\nimport { BaseDecorator } from './BaseDecorator';\nimport { getWindow, hoistStatics } from '../../Utilities';\n\nexport interface IWithResponsiveModeState {\n  responsiveMode?: ResponsiveMode;\n}\n\nexport enum ResponsiveMode {\n  small = 0,\n  medium = 1,\n  large = 2,\n  xLarge = 3,\n  xxLarge = 4,\n  xxxLarge = 5\n}\n\nconst RESPONSIVE_MAX_CONSTRAINT = [479, 639, 1023, 1365, 1919, 99999999];\n\nlet _defaultMode: ResponsiveMode | undefined;\n\n/**\n * Allows a server rendered scenario to provide a default responsive mode.\n */\nexport function setResponsiveMode(responsiveMode: ResponsiveMode | undefined): void {\n  _defaultMode = responsiveMode;\n}\n\nexport function withResponsiveMode<TProps extends { responsiveMode?: ResponsiveMode }, TState>(\n  ComposedComponent: new (props: TProps, ...args: any[]) => React.Component<TProps, TState>\n): any {\n  const resultClass = class WithResponsiveMode extends BaseDecorator<TProps, IWithResponsiveModeState> {\n    constructor(props: TProps) {\n      super(props);\n      this._updateComposedComponentRef = this._updateComposedComponentRef.bind(this);\n\n      this.state = {\n        responsiveMode: this._getResponsiveMode()\n      };\n    }\n\n    public componentDidMount(): void {\n      this._events.on(window, 'resize', () => {\n        const responsiveMode = this._getResponsiveMode();\n\n        if (responsiveMode !== this.state.responsiveMode) {\n          this.setState({\n            responsiveMode: responsiveMode\n          });\n        }\n      });\n    }\n\n    public componentWillUnmount(): void {\n      this._events.dispose();\n    }\n\n    public render(): JSX.Element {\n      const { responsiveMode } = this.state;\n\n      return <ComposedComponent ref={this._updateComposedComponentRef} responsiveMode={responsiveMode} {...this.props as any} />;\n    }\n\n    private _getResponsiveMode(): ResponsiveMode {\n      let responsiveMode = ResponsiveMode.small;\n      const win = getWindow();\n\n      if (typeof win !== 'undefined') {\n        try {\n          while (win.innerWidth > RESPONSIVE_MAX_CONSTRAINT[responsiveMode]) {\n            responsiveMode++;\n          }\n        } catch (e) {\n          // Return a best effort result in cases where we're in the browser but it throws on getting innerWidth.\n          responsiveMode = ResponsiveMode.large;\n        }\n      } else {\n        if (_defaultMode !== undefined) {\n          responsiveMode = _defaultMode;\n        } else {\n          throw new Error(\n            'Content was rendered in a server environment without providing a default responsive mode. ' +\n              'Call setResponsiveMode to define what the responsive mode is.'\n          );\n        }\n      }\n\n      return responsiveMode;\n    }\n  };\n  return hoistStatics(ComposedComponent, resultClass);\n}\n"]}