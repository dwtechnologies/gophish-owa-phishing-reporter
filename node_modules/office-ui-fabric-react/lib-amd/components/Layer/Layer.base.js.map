{"version":3,"file":"Layer.base.js","sourceRoot":"../src/","sources":["components/Layer/Layer.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { Fabric } from '../../Fabric';\nimport { ILayerProps, ILayerStyleProps, ILayerStyles } from './Layer.types';\nimport { classNamesFunction, customizable, getDocument, setPortalAttribute, setVirtualParent, warnDeprecations } from '../../Utilities';\nimport { registerLayer, getDefaultTarget, unregisterLayer } from './Layer.notification';\n\nexport type ILayerBaseState = {\n  hasMounted: boolean;\n};\n\nconst getClassNames = classNamesFunction<ILayerStyleProps, ILayerStyles>();\n\n@customizable('Layer', ['theme', 'hostId'])\nexport class LayerBase extends React.Component<ILayerProps, ILayerBaseState> {\n  public static defaultProps: ILayerProps = {\n    onLayerDidMount: () => undefined,\n    onLayerWillUnmount: () => undefined\n  };\n\n  private _host: Node;\n  private _layerElement: HTMLElement | undefined;\n  private _rootElement: HTMLSpanElement | undefined;\n\n  constructor(props: ILayerProps) {\n    super(props);\n\n    this.state = {\n      hasMounted: false\n    };\n\n    if (process.env.NODE_ENV !== 'production') {\n      warnDeprecations('Layer', props, {\n        onLayerMounted: 'onLayerDidMount'\n      });\n    }\n\n    if (this.props.hostId) {\n      registerLayer(this.props.hostId, this);\n    }\n  }\n\n  // tslint:disable-next-line function-name\n  public UNSAFE_componentWillMount(): void {\n    this._layerElement = this._getLayerElement();\n  }\n\n  // tslint:disable-next-line function-name\n  public UNSAFE_componentWillUpdate(): void {\n    if (!this._layerElement) {\n      this._layerElement = this._getLayerElement();\n    }\n  }\n\n  public componentDidMount(): void {\n    // We can safely set state immediately because the ref wrapper will make sure the virtual\n    //    parent has been set before componentDidMount is called.\n    this.setState({ hasMounted: true });\n\n    this._setVirtualParent();\n\n    const { onLayerDidMount, onLayerMounted } = this.props;\n    if (onLayerMounted) {\n      onLayerMounted();\n    }\n\n    if (onLayerDidMount) {\n      onLayerDidMount();\n    }\n  }\n\n  public componentWillUnmount(): void {\n    this._removeLayerElement();\n\n    const { onLayerWillUnmount, hostId } = this.props;\n    if (onLayerWillUnmount) {\n      onLayerWillUnmount();\n    }\n\n    if (hostId) {\n      unregisterLayer(hostId, this);\n    }\n  }\n\n  public componentDidUpdate(): void {\n    this._setVirtualParent();\n  }\n\n  public render(): React.ReactNode {\n    const classNames = this._getClassNames();\n    const { eventBubblingEnabled } = this.props;\n    const { hasMounted } = this.state;\n\n    return (\n      <span className=\"ms-layer\" ref={this._handleRootElementRef}>\n        {this._layerElement &&\n          hasMounted &&\n          ReactDOM.createPortal(\n            eventBubblingEnabled ? (\n              <Fabric className={classNames.content}>{this.props.children}</Fabric>\n            ) : (\n              <Fabric\n                className={classNames.content}\n                onClick={this._filterEvent}\n                onContextMenu={this._filterEvent}\n                onDoubleClick={this._filterEvent}\n                onDrag={this._filterEvent}\n                onDragEnd={this._filterEvent}\n                onDragEnter={this._filterEvent}\n                onDragExit={this._filterEvent}\n                onDragLeave={this._filterEvent}\n                onDragOver={this._filterEvent}\n                onDragStart={this._filterEvent}\n                onDrop={this._filterEvent}\n                onMouseDown={this._filterEvent}\n                onMouseEnter={this._filterEvent}\n                onMouseLeave={this._filterEvent}\n                onMouseMove={this._filterEvent}\n                onMouseOver={this._filterEvent}\n                onMouseOut={this._filterEvent}\n                onMouseUp={this._filterEvent}\n                onKeyDown={this._filterEvent}\n                onKeyPress={this._filterEvent}\n                onKeyUp={this._filterEvent}\n                onFocus={this._filterEvent}\n                onBlur={this._filterEvent}\n                onChange={this._filterEvent}\n                onInput={this._filterEvent}\n                onInvalid={this._filterEvent}\n                onSubmit={this._filterEvent}\n              >\n                {this.props.children}\n              </Fabric>\n            ),\n            this._layerElement\n          )}\n      </span>\n    );\n  }\n\n  /**\n   * rootElement wrapper for setting virtual parent as soon as root element ref is available.\n   */\n  private _handleRootElementRef = (ref: HTMLSpanElement): void => {\n    this._rootElement = ref;\n    if (ref) {\n      // TODO: Calling _setVirtualParent in this ref wrapper SHOULD allow us to remove\n      //    other calls to _setVirtualParent throughout this class. However,\n      //    as this is an immediate fix for a P0 issue the existing _setVirtualParent\n      //    calls are left for now to minimize potential regression.\n      this._setVirtualParent();\n    }\n  };\n\n  /**\n   * Helper to stop events from bubbling up out of Layer.\n   */\n  private _filterEvent = (ev: React.SyntheticEvent<HTMLElement>): void => {\n    // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though mouseenter and\n    //    mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on event name rather than ev.bubble.\n    if (ev.eventPhase === Event.BUBBLING_PHASE && ev.type !== 'mouseenter' && ev.type !== 'mouseleave') {\n      ev.stopPropagation();\n    }\n  };\n\n  private _getClassNames() {\n    const { className, styles, theme } = this.props;\n    const classNames = getClassNames(styles!, {\n      theme: theme!,\n      className,\n      isNotHost: !this.props.hostId\n    });\n\n    return classNames;\n  }\n\n  private _setVirtualParent() {\n    if (this._rootElement && this._layerElement) {\n      setVirtualParent(this._layerElement, this._rootElement);\n    }\n  }\n\n  private _getLayerElement(): HTMLElement | undefined {\n    const host = this._getHost();\n\n    const classNames = this._getClassNames();\n\n    if (host !== this._host) {\n      this._removeLayerElement();\n    }\n\n    if (host) {\n      this._host = host;\n\n      if (!this._layerElement) {\n        const doc = getDocument();\n        if (!doc) {\n          return;\n        }\n\n        this._layerElement = doc.createElement('div');\n        this._layerElement.className = classNames.root!;\n        setPortalAttribute(this._layerElement);\n\n        this.props.insertFirst ? host.insertBefore(this._layerElement, host.firstChild) : host.appendChild(this._layerElement);\n      }\n    }\n\n    return this._layerElement;\n  }\n\n  private _removeLayerElement(): void {\n    if (this._layerElement) {\n      this.props.onLayerWillUnmount!();\n\n      const parentNode = this._layerElement.parentNode;\n      if (parentNode) {\n        parentNode.removeChild(this._layerElement);\n      }\n      this._layerElement = undefined;\n    }\n  }\n\n  private _getHost(): Node | undefined {\n    const { hostId } = this.props;\n\n    const doc = getDocument();\n    if (!doc) {\n      return undefined;\n    }\n\n    if (hostId) {\n      return doc.getElementById(hostId) as Node;\n    } else {\n      const defaultHostSelector = getDefaultTarget();\n      return defaultHostSelector ? (doc.querySelector(defaultHostSelector) as Node) : doc.body;\n    }\n  }\n}\n"]}