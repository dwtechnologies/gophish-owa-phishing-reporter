{"version":3,"file":"CommandBar.base.js","sourceRoot":"../src/","sources":["components/CommandBar/CommandBar.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport { BaseComponent, css, nullRender } from '../../Utilities';\nimport { ICommandBar, ICommandBarItemProps, ICommandBarProps, ICommandBarStyleProps, ICommandBarStyles } from './CommandBar.types';\nimport { IOverflowSet, OverflowSet } from '../../OverflowSet';\nimport { IResizeGroup, ResizeGroup } from '../../ResizeGroup';\nimport { FocusZone, FocusZoneDirection } from '../../FocusZone';\nimport { classNamesFunction } from '../../Utilities';\nimport { CommandBarButton, IButtonProps } from '../../Button';\nimport { TooltipHost } from '../../Tooltip';\nimport { IComponentAs } from '@uifabric/utilities';\n\nconst getClassNames = classNamesFunction<ICommandBarStyleProps, ICommandBarStyles>();\n\nexport interface ICommandBarData {\n  /**\n   * Items being rendered in the primary region\n   */\n  primaryItems: ICommandBarItemProps[];\n  /**\n   * Items being rendered in the overflow\n   */\n  overflowItems: ICommandBarItemProps[];\n  /**\n   * Items being rendered on the far side\n   */\n  farItems: ICommandBarItemProps[] | undefined;\n  /**\n   * Length of original overflowItems to ensure that they are not moved into primary region on resize\n   */\n  minimumOverflowItems: number;\n  /**\n   * Unique string used to cache the width of the command bar\n   */\n  cacheKey: string;\n}\n\nexport class CommandBarBase extends BaseComponent<ICommandBarProps, {}> implements ICommandBar {\n  public static defaultProps: ICommandBarProps = {\n    items: [],\n    overflowItems: []\n  };\n\n  private _overflowSet = React.createRef<IOverflowSet>();\n  private _resizeGroup = React.createRef<IResizeGroup>();\n  private _classNames: { [key in keyof ICommandBarStyles]: string };\n\n  public render(): JSX.Element {\n    const {\n      className,\n      items,\n      overflowItems,\n      farItems,\n      styles,\n      theme,\n      dataDidRender,\n      onReduceData = this._onReduceData,\n      onGrowData = this._onGrowData\n    } = this.props;\n\n    const commandBarData: ICommandBarData = {\n      primaryItems: [...items],\n      overflowItems: [...overflowItems!],\n      minimumOverflowItems: [...overflowItems!].length, // for tracking\n      farItems,\n      cacheKey: ''\n    };\n\n    this._classNames = getClassNames(styles!, { theme: theme! });\n\n    return (\n      <ResizeGroup\n        componentRef={this._resizeGroup}\n        className={className}\n        data={commandBarData}\n        onReduceData={onReduceData}\n        onGrowData={onGrowData}\n        onRenderData={this._onRenderData}\n        dataDidRender={dataDidRender}\n      />\n    );\n  }\n\n  public focus(): void {\n    const { current: overflowSet } = this._overflowSet;\n\n    overflowSet && overflowSet.focus();\n  }\n\n  public remeasure(): void {\n    this._resizeGroup.current && this._resizeGroup.current.remeasure();\n  }\n\n  private _onRenderData = (data: ICommandBarData): JSX.Element => {\n    return (\n      <FocusZone\n        className={css(this._classNames.root)}\n        direction={FocusZoneDirection.horizontal}\n        role={'menubar'}\n        aria-label={this.props.ariaLabel}\n      >\n        {/*Primary Items*/}\n        <OverflowSet\n          componentRef={this._resolveRef('_overflowSet')}\n          className={css(this._classNames.primarySet)}\n          doNotContainWithinFocusZone={true}\n          role={'presentation'}\n          items={data.primaryItems}\n          overflowItems={data.overflowItems.length ? data.overflowItems : undefined}\n          onRenderItem={this._onRenderItem}\n          onRenderOverflowButton={this._onRenderOverflowButton}\n        />\n\n        {/*Secondary Items*/}\n        {data.farItems && (\n          <OverflowSet\n            className={css(this._classNames.secondarySet)}\n            doNotContainWithinFocusZone={true}\n            role={'presentation'}\n            items={data.farItems}\n            onRenderItem={this._onRenderItem}\n            onRenderOverflowButton={nullRender}\n          />\n        )}\n      </FocusZone>\n    );\n  };\n\n  private _onRenderItem = (item: ICommandBarItemProps): JSX.Element | React.ReactNode => {\n    if (item.onRender) {\n      // These are the top level items, there is no relevant menu dismissing function to\n      // provide for the IContextualMenuItem onRender function. Pass in a no op function instead.\n      return item.onRender(item, () => undefined);\n    }\n\n    const itemText = item.text || item.name;\n    const commandButtonProps: ICommandBarItemProps = {\n      allowDisabledFocus: true,\n      role: 'menuitem',\n      ...item,\n      styles: { root: { height: '100%' }, label: { whiteSpace: 'nowrap' }, ...item.buttonStyles },\n      className: css('ms-CommandBarItem-link', item.className),\n      text: !item.iconOnly ? itemText : undefined,\n      menuProps: item.subMenuProps,\n      onClick: this._onButtonClick(item)\n    };\n\n    if (item.iconOnly && itemText !== undefined) {\n      return (\n        <TooltipHost content={itemText} {...item.tooltipHostProps}>\n          {this._commandButton(item, commandButtonProps)}\n        </TooltipHost>\n      );\n    }\n\n    return this._commandButton(item, commandButtonProps);\n  };\n\n  private _commandButton = (item: ICommandBarItemProps, props: ICommandBarItemProps): JSX.Element => {\n    const ButtonAs = this.props.buttonAs as (IComponentAs<ICommandBarItemProps> | undefined);\n    const CommandBarButtonAs = item.commandBarButtonAs as (IComponentAs<ICommandBarItemProps> | undefined);\n    const DefaultButtonAs = (CommandBarButton as {}) as IComponentAs<ICommandBarItemProps>;\n\n    // The prop types between these three possible implementations overlap enough that a force-cast is safe.\n    const Type = ButtonAs || CommandBarButtonAs || DefaultButtonAs;\n\n    // Always pass the default implementation to the override so it may be composed.\n    return <Type {...props as ICommandBarItemProps} defaultRender={DefaultButtonAs} />;\n  };\n\n  private _onButtonClick(item: ICommandBarItemProps): (ev: React.MouseEvent<HTMLButtonElement>) => void {\n    return ev => {\n      // inactive is deprecated. remove check in 7.0\n      if (item.inactive) {\n        return;\n      }\n      if (item.onClick) {\n        item.onClick(ev, item);\n      }\n    };\n  }\n\n  private _onRenderOverflowButton = (overflowItems: ICommandBarItemProps[]): JSX.Element => {\n    const {\n      overflowButtonAs: OverflowButtonType = CommandBarButton,\n      overflowButtonProps = {} // assure that props is not empty\n    } = this.props;\n\n    const combinedOverflowItems: ICommandBarItemProps[] = [\n      ...(overflowButtonProps.menuProps ? overflowButtonProps.menuProps.items : []),\n      ...overflowItems\n    ];\n\n    const overflowProps: IButtonProps = {\n      ...overflowButtonProps,\n      styles: { menuIcon: { fontSize: '17px' }, ...overflowButtonProps.styles },\n      className: css('ms-CommandBar-overflowButton', overflowButtonProps.className),\n      menuProps: { ...overflowButtonProps.menuProps, items: combinedOverflowItems },\n      menuIconProps: { iconName: 'More', ...overflowButtonProps.menuIconProps }\n    };\n\n    return <OverflowButtonType {...overflowProps as IButtonProps} />;\n  };\n\n  private _computeCacheKey(data: ICommandBarData): string {\n    const { primaryItems, farItems = [], overflowItems } = data;\n    const returnKey = (acc: string, current: ICommandBarItemProps): string => {\n      const { cacheKey = current.key } = current;\n      return acc + cacheKey;\n    };\n\n    const primaryKey = primaryItems.reduce(returnKey, '');\n    const farKey = farItems.reduce(returnKey, '');\n    const overflowKey = !!overflowItems.length ? 'overflow' : '';\n\n    return [primaryKey, farKey, overflowKey].join(' ');\n  }\n\n  private _onReduceData = (data: ICommandBarData): ICommandBarData | undefined => {\n    const { shiftOnReduce, onDataReduced } = this.props;\n    let { primaryItems, overflowItems, cacheKey } = data;\n\n    // Use first item if shiftOnReduce, otherwise use last item\n    const movedItem = primaryItems[shiftOnReduce ? 0 : primaryItems.length - 1];\n\n    if (movedItem !== undefined) {\n      movedItem.renderedInOverflow = true;\n\n      overflowItems = [movedItem, ...overflowItems];\n      primaryItems = shiftOnReduce ? primaryItems.slice(1) : primaryItems.slice(0, -1);\n\n      const newData = { ...data, primaryItems, overflowItems };\n      cacheKey = this._computeCacheKey(newData);\n\n      if (onDataReduced) {\n        onDataReduced(movedItem);\n      }\n\n      newData.cacheKey = cacheKey;\n      return newData;\n    }\n\n    return undefined;\n  };\n\n  private _onGrowData = (data: ICommandBarData): ICommandBarData | undefined => {\n    const { shiftOnReduce, onDataGrown } = this.props;\n    const { minimumOverflowItems } = data;\n    let { primaryItems, overflowItems, cacheKey } = data;\n    const movedItem = overflowItems[0];\n\n    // Make sure that moved item exists and is not one of the original overflow items\n    if (movedItem !== undefined && overflowItems.length > minimumOverflowItems) {\n      movedItem.renderedInOverflow = false;\n\n      overflowItems = overflowItems.slice(1);\n      // if shiftOnReduce, movedItem goes first, otherwise, last.\n      primaryItems = shiftOnReduce ? [movedItem, ...primaryItems] : [...primaryItems, movedItem];\n\n      const newData = { ...data, primaryItems, overflowItems };\n      cacheKey = this._computeCacheKey(newData);\n\n      if (onDataGrown) {\n        onDataGrown(movedItem);\n      }\n\n      newData.cacheKey = cacheKey;\n      return newData;\n    }\n\n    return undefined;\n  };\n}\n"]}